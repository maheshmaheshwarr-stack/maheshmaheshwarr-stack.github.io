<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PDF Chatbot Diagnostic</title>
  <style>
    body {
      font-family: system-ui, -apple-system, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f8fafc;
    }
    .status {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .success { background: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
    .error { background: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
    .warning { background: #fef3c7; color: #92400e; border-left: 4px solid #f59e0b; }
    .info { background: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
    h1 { color: #1e293b; }
    h2 { color: #475569; margin-top: 32px; }
    code { 
      background: #f1f5f9; 
      padding: 2px 6px; 
      border-radius: 4px; 
      font-size: 14px;
      color: #1e40af;
    }
    .check-item {
      padding: 12px;
      margin: 8px 0;
      background: white;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    button {
      padding: 10px 20px;
      background: #1e40af;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      margin-right: 10px;
      margin-top: 10px;
    }
    button:hover { background: #1e3a8a; }
    pre {
      background: #1e293b;
      color: #e2e8f0;
      padding: 16px;
      border-radius: 8px;
      overflow-x: auto;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <h1>üîç PDF Chatbot Diagnostic</h1>
  <p>This page will help diagnose why the PDF isn't loading.</p>

  <div id="protocol-check" class="status info">‚è≥ Checking...</div>

  <h2>Diagnostic Results</h2>
  <div id="results"></div>

  <h2>Quick Fixes</h2>
  <div id="fixes"></div>

  <h2>Console Output</h2>
  <div id="console-output"></div>

  <script>
    const results = document.getElementById('results');
    const fixes = document.getElementById('fixes');
    const protocolCheck = document.getElementById('protocol-check');
    const consoleOutput = document.getElementById('console-output');

    // Capture console logs
    const logs = [];
    const originalLog = console.log;
    const originalError = console.error;
    
    console.log = function(...args) {
      logs.push({ type: 'log', message: args.join(' ') });
      originalLog.apply(console, args);
      updateConsoleOutput();
    };
    
    console.error = function(...args) {
      logs.push({ type: 'error', message: args.join(' ') });
      originalError.apply(console, args);
      updateConsoleOutput();
    };

    function updateConsoleOutput() {
      consoleOutput.innerHTML = '<pre>' + logs.map(log => {
        const prefix = log.type === 'error' ? '‚ùå' : 'üìù';
        return `${prefix} ${log.message}`;
      }).join('\n') + '</pre>';
    }

    // Check 1: Protocol
    const protocol = window.location.protocol;
    let checksHTML = '';
    let fixesHTML = '';

    if (protocol === 'file:') {
      protocolCheck.className = 'status error';
      protocolCheck.innerHTML = '‚ùå Problem Found: Using file:// protocol';
      
      checksHTML += `
        <div class="check-item">
          <strong>‚ùå Protocol Check: FAILED</strong><br>
          Current: <code>${protocol}</code><br>
          Required: <code>http:</code> or <code>https:</code><br>
          <br>
          <strong>Why this matters:</strong> PDF.js cannot load PDFs from file:// due to browser security (CORS).
        </div>
      `;

      fixesHTML = `
        <div class="status warning">
          <strong>‚ö†Ô∏è You need to use a web server</strong><br><br>
          
          <strong>Option 1: Python (Easiest)</strong><br>
          Open Terminal in the <code>personal-site-repo</code> folder and run:<br>
          <pre>python3 -m http.server 8000</pre>
          Then open: <a href="http://localhost:8000" target="_blank">http://localhost:8000</a>
          <br><br>

          <strong>Option 2: Use the script</strong><br>
          <pre>cd personal-site-repo
./start-server.sh</pre>
          <br>

          <strong>Option 3: Deploy to GitHub Pages</strong><br>
          Push your changes to GitHub and test on the live site.
        </div>
      `;
    } else {
      protocolCheck.className = 'status success';
      protocolCheck.innerHTML = '‚úÖ Protocol Check: PASSED';
      
      checksHTML += `
        <div class="check-item">
          <strong>‚úÖ Protocol Check: PASSED</strong><br>
          Current: <code>${protocol}</code><br>
          This is correct! PDF.js can load files.
        </div>
      `;
    }

    // Check 2: PDF.js loaded
    checksHTML += `
      <div class="check-item">
        <strong>${typeof pdfjsLib !== 'undefined' ? '‚úÖ' : '‚ùå'} PDF.js Library: ${typeof pdfjsLib !== 'undefined' ? 'LOADED' : 'NOT LOADED'}</strong><br>
        ${typeof pdfjsLib !== 'undefined' ? 'PDF.js is available and ready to use.' : 'PDF.js library failed to load from CDN.'}
      </div>
    `;

    // Check 3: PDF file exists
    checksHTML += `
      <div class="check-item">
        <strong>‚è≥ PDF File Check: TESTING...</strong><br>
        <span id="pdf-check">Checking if Mahesh_Ramanathan_Resume.pdf exists...</span>
      </div>
    `;

    results.innerHTML = checksHTML;
    fixes.innerHTML = fixesHTML;

    // Test PDF loading
    if (typeof pdfjsLib !== 'undefined' && protocol !== 'file:') {
      setTimeout(async () => {
        try {
          console.log('Testing PDF load...');
          const response = await fetch('Mahesh_Ramanathan_Resume.pdf');
          if (response.ok) {
            document.getElementById('pdf-check').innerHTML = '‚úÖ PDF file found and accessible!';
            
            // Try to load it
            console.log('Attempting to parse PDF...');
            const loadingTask = pdfjsLib.getDocument('Mahesh_Ramanathan_Resume.pdf');
            const pdf = await loadingTask.promise;
            console.log(`‚úÖ PDF loaded successfully! ${pdf.numPages} pages`);
            
            document.getElementById('pdf-check').innerHTML = `‚úÖ PDF loaded successfully! ${pdf.numPages} pages found.`;
            
            fixes.innerHTML = `
              <div class="status success">
                <strong>üéâ Everything is working!</strong><br><br>
                The PDF is loading correctly. Your chatbot should be able to read the resume.<br><br>
                <strong>Next steps:</strong><br>
                1. Go back to your main website (index.html)<br>
                2. Open the chatbot<br>
                3. Ask: "What is my educational background?"<br>
                4. You should see "üìÑ From Resume:" with content
              </div>
            `;
          } else {
            document.getElementById('pdf-check').innerHTML = `‚ùå PDF file not found (${response.status})`;
          }
        } catch (error) {
          console.error('PDF load error:', error);
          document.getElementById('pdf-check').innerHTML = `‚ùå Error: ${error.message}`;
        }
      }, 1000);
    }

    // Check 4: Browser info
    checksHTML += `
      <div class="check-item">
        <strong>‚ÑπÔ∏è Browser Information</strong><br>
        User Agent: <code>${navigator.userAgent}</code><br>
        Location: <code>${window.location.href}</code>
      </div>
    `;

    results.innerHTML = checksHTML;
  </script>

  <!-- PDF.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
</body>
</html>
